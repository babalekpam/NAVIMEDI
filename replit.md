# Healthcare Management Platform

## Overview
This project is a comprehensive multi-tenant healthcare management platform designed to optimize operations and workflows across various healthcare entities, including hospitals, clinics, pharmacies, and laboratories. Its core purpose is to streamline prescription management, facilitate insurance claims processing, manage patient records, and enhance communication between healthcare providers and patients. The platform aims to be a leading solution in digital health, improving efficiency, patient care, and data management in a secure and compliant manner.

## User Preferences
- Simple, everyday language for communication (user is non-technical)
- Focus on functionality testing rather than code details
- Prioritize working features over perfect TypeScript compliance

## Recent Changes
- **Patient Registration with Insurance Information Completed (August 1, 2025)**: Successfully enhanced patient registration form with comprehensive insurance information capture. Added insurance provider dropdown, policy number, group number, subscriber details, relationship selection, copay amount, and deductible amount fields. Fixed "Add New Patient" 404 error by correcting sidebar navigation from `/patients/new` to `/patients?action=register`. Patient creation form now captures all essential insurance details during registration, improving billing workflow efficiency and reducing data entry requirements for staff.
- **Pharmacy Patient Insurance Management System Fully Operational (August 1, 2025)**: Successfully implemented comprehensive pharmacy patient insurance management with coverage percentage functionality. Fixed database schema mismatch between simplified frontend interface and complex primary/secondary insurance backend structure. Created transformation layer to properly map data between frontend and database. Added required coverage percentage field (0-100%) with visual green highlighting. Fixed type conversion errors for monetary fields ensuring proper number formatting. System now fully functional with proper multi-tenant isolation for pharmacy operations.
- **Complete Pharmacy Report System with Download & View Functionality (August 1, 2025)**: Successfully implemented comprehensive pharmacy report generation system with full download and view capabilities. Fixed all authentication issues, database schema problems, and API request function signatures. All 5 report types (Sales, Prescription, Inventory, Patient, Insurance) now work perfectly with real pharmacy transaction data. Added interactive "View" button that opens formatted HTML tables in new browser tabs and enhanced "Download CSV" functionality for file export. Report generation tested and confirmed working with actual pharmacy receipts data including Metformin, Lisinopril, Atorvastatin, and Amoxicillin transactions.
- **Shift Management Removed from Pharmacy Operations (August 1, 2025)**: Removed shift management functionality specifically for pharmacy operations per user request. Eliminated shift-related navigation items, API endpoints, database queries, and report generation while maintaining core pharmacy features (patient management, billing, reports, prescriptions). Updated sidebar navigation and report types to focus on 5 core pharmacy reports: Sales, Prescription, Inventory, Patient, and Insurance. Archive system functionality adjusted to work without shift dependencies.
- **Comprehensive Pharmacy Report Generation System Implemented (August 1, 2025)**: Successfully developed complete report generation functionality for pharmacy operations. Built PharmacyReports.tsx with 5 report types (Sales, Prescription, Inventory, Patient, Insurance), interactive date range selection, template management system, and CSV download capability. Implemented backend API routes for all report types with real database queries and proper tenant isolation. Added comprehensive analytics and reporting infrastructure with customizable templates and automated data generation.
- **Pharmacy System Enhancements & Bug Fixes (August 1, 2025)**: Fixed critical pharmacy billing errors including undefined amount handling and analytics calculation issues. Enhanced shift management, patient insurance tracking, and archive functionality. Resolved null reference errors in pharmacy billing interface and improved data validation throughout pharmacy workflows.
- **Gamified Achievement System Fully Operational (August 1, 2025)**: Successfully implemented and integrated complete gamified achievement system for laboratory performance tracking. Created comprehensive achievement infrastructure with automatic tracking on lab completion, real-time progress updates, interactive leaderboards, and achievement notifications. Integrated AchievementDisplay.tsx component and dedicated achievements.tsx page with full functionality. Added Laboratory Achievements navigation to sidebar for laboratory users. Achievement system includes 24 different achievement types covering productivity, quality, efficiency, and milestone metrics with automatic badge unlocking and progress tracking.
- **Unified Billing Systems Implementation (August 1, 2025)**: Successfully implemented comprehensive billing systems for all three tenant types. Created hospital-billing.tsx focused on patient care procedures and insurance claims, pharmacy-billing.tsx focused on prescription medication sales and insurance processing, and enhanced the existing laboratory-billing.tsx. Added backend API endpoints `/api/hospital/billing`, `/api/pharmacy/billing`, and analytics endpoints for each tenant type. Updated sidebar navigation and App.tsx routing. Each billing system features personalized analytics, reporting, and tenant-specific workflows with real-time data synchronization.
- **Laboratory Quick Report Generation Removed (August 1, 2025)**: Removed non-functional Quick Report Generation section from Laboratory Billing dashboard due to persistent database constraint and authentication issues. The section contained buttons for Billing Summary, Revenue Analysis, Patient Billing, and Test Analysis reports that failed due to database foreign key constraints on the reports table. Cleaned up associated code, mutations, and unused imports to maintain clean dashboard functionality.
- **Report Download Functionality Fixed (August 1, 2025)**: Resolved critical issue where generated reports failed to open after download. Backend was generating plain text content instead of proper binary files for PDFs. Implemented proper PDF binary content generation with valid PDF structure, updated download endpoints to send appropriate content headers and buffers, and enhanced frontend download handling with better error logging. All report formats (PDF, Excel, CSV) now download and open correctly in their respective applications.
- **Notification System Activated (August 1, 2025)**: Activated bell notification icons across the entire platform with interactive functionality. Main header now features a dropdown notification menu with real-time notifications for lab results, insurance claims, and appointments. Patient portal and staff interfaces now display active notification indicators with visual pulsing effects. All notification icons are now properly styled with blue coloring and hover effects for better user experience.
- **Laboratory Billing Analytics & Reports System (August 1, 2025)**: Implemented comprehensive tabbed interface in laboratory billing system with Billing, Analytics, Reports, and Trends sections. Added real-time analytics API endpoints providing billing metrics, revenue analysis, and KPIs. Reports tab integrates with existing reporting infrastructure for download and print capabilities. Analytics show total bills, revenue, completion rates, and processing times.
- **Laboratory Bill Status Synchronization Fixed (August 1, 2025)**: Resolved issue where laboratory bill statuses weren't updating in real-time when lab orders were completed. Implemented auto-refresh with 5-second intervals and disabled React Query caching to ensure immediate status updates. Bill synchronization now works correctly - when lab orders are marked "completed", associated bills automatically update to "completed" status.
- **Insurance Auto-Population Fixed (July 31, 2025)**: Resolved complex issue with insurance provider field not populating in pharmacy dashboard. Root cause was React controlled component state conflicts. Final solution implemented using React refs with focus/blur triggers for reliable field population.
- **Pharmacy Receipt Validation Fixed (July 31, 2025)**: Resolved date validation errors in pharmacy receipt creation. Backend now properly converts prescribedDate strings to Date objects during API processing, eliminating JSON serialization issues.

## System Architecture
The platform is built on a modern stack ensuring scalability, security, and maintainability.

-   **Frontend**: Developed with React and TypeScript, leveraging Tailwind CSS for a utility-first styling approach, ensuring a clean and responsive user interface.
-   **Backend**: Powered by Node.js and Express.js, written in TypeScript, providing a robust and efficient API layer.
-   **Database**: Utilizes PostgreSQL as the primary data store, managed through Drizzle ORM for type-safe and efficient database interactions.
-   **Authentication**: Implements JWT (JSON Web Token) for secure user authentication, coupled with a granular role-based access control (RBAC) system to manage user permissions across different modules and tenants.
-   **Multi-tenancy**: Designed with a strong multi-tenant architecture where data is strictly isolated per organization (hospital, pharmacy, laboratory), while allowing for controlled cross-tenant interactions where necessary (e.g., prescription routing, lab order routing). Super admin capabilities oversee the entire system.
-   **Role Separation**: Enforces strict role separation, ensuring users have access only to functionalities relevant to their role and tenant type. For instance, receptionists are exclusive to hospitals/clinics and do not exist in pharmacy operations.
-   **UI/UX Decisions**:
    -   Intuitive navigation with distinct dashboards for different user roles (admin, doctor, nurse, receptionist, pharmacy staff, lab staff).
    -   Color-coded alerts and visual indicators for statuses (e.g., abnormal lab results, consultation drafts).
    -   Streamlined workflows for common tasks like patient registration, appointment booking, prescription dispensing, and lab order processing.
    -   Comprehensive patient portal with features like health tracking, medical records access, and secure messaging.
    -   Dynamic permission management UI for tenant administrators to customize role capabilities.
-   **Technical Implementations**:
    -   **Automated Insurance Verification & Copay Calculation**: System automatically fetches patient insurance details, identifies primary policies, and calculates copays based on coverage rules, eliminating manual entry.
    -   **Cross-Tenant Patient & Data Synchronization**: Enables secure and compliant sharing of patient and insurance data across relevant tenants (e.g., a pharmacy accessing a hospital's patient insurance data for billing).
    -   **Pharmacy Workflow Management**: Features a complete workflow (New → Insurance Verification → Processing → Ready → Dispensed) with real-time status updates and archiving capabilities.
    -   **Bidirectional Medical Communications**: A unified messaging system allows secure and compliant communication between patients and doctors, and vice-versa.
    -   **Lab Order & Results Management**: Supports creation and routing of lab orders from hospitals to specific laboratories, along with comprehensive management and viewing of lab results in patient and doctor portals.
    -   **Patient Portal & Telemedicine**: Provides a secure patient portal with features like appointment booking, health tracking, and integrated telemedicine consultation setup.
    -   **Dynamic Role Permissions**: Allows tenant administrators to granularly define and manage permissions for each user role within their organization.
    -   **Automated Currency Detection**: Assigns currency based on the hospital's geographic location during registration.
    -   **Multi-language Support**: Features a fully functional translation system for the user interface.
    -   **Enterprise Features**: Includes white-label branding capabilities, tiered pricing plans, and offline synchronization for robust enterprise deployments.

## External Dependencies
The platform integrates with several external components and services to deliver its full functionality:

-   **PostgreSQL**: The primary relational database.
-   **JWT (JSON Web Tokens)**: Used for secure authentication and authorization.
-   **Drizzle ORM**: An object-relational mapper for interacting with PostgreSQL.
-   **YouTube, Vimeo Business, AWS Enterprise**: Options for video tutorial hosting and integration.
-   **Custom API Endpoints**:
    -   `/api/patient-insurance/:patientId`: For fetching patient insurance details cross-tenant.
    -   `/api/billing/patients`: For cross-tenant patient synchronization for billing.
    -   `/api/medical-communications`: Unified endpoint for patient-doctor messaging.
    -   `/api/patient/patients-list` and `/api/patient/doctors-list`: For hospital directory synchronization in the patient portal.
    -   `/api/patients/:id` (PATCH): For medical history updates by physicians.
-   **Payment Gateways**: Implicitly required for payment processing and receipt generation (specific providers not explicitly named but supported by the architecture).
-   **Email Service**: For sending user credentials, welcome messages, and other notifications.