# Apache SSL/TLS Configuration for NaviMED
# Fixes: Lucky 13 (CVE-2013-0169) and Obsoleted CBC Ciphers
# Place this in your Apache configuration or .htaccess file

# SSL Protocol Configuration - CRITICAL for vulnerability fixes
SSLEngine on
SSLProtocol -all +TLSv1.2 +TLSv1.3

# Disable vulnerable SSL/TLS versions
SSLProtocol -SSLv2 -SSLv3 -TLSv1 -TLSv1.1

# Strong Cipher Suites - Disable CBC, Enable GCM
SSLCipherSuite ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256

# Honor cipher order preference
SSLHonorCipherOrder on

# Disable compression to prevent BREACH attacks
SSLCompression off

# Enable OCSP Stapling for better performance
SSLUseStapling on
SSLStaplingResponderTimeout 5
SSLStaplingReturnResponderErrors off
SSLStaplingCache "shmcb:${APACHE_RUN_DIR}/ocsp(128000)"

# Security Headers for additional protection
Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
Header always set X-Frame-Options DENY
Header always set X-Content-Type-Options nosniff
Header always set Referrer-Policy "strict-origin-when-cross-origin"
Header always set X-XSS-Protection "1; mode=block"

# Additional SSL hardening
SSLSessionTickets off
SSLInsecureRenegotiation off

# Perfect Forward Secrecy
SSLOpenSSLConfCmd DHParameters "/etc/ssl/certs/dhparam.pem"