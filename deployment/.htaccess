# NaviMED .htaccess Security Configuration
# Apply SSL/TLS security measures for deployment

<IfModule mod_ssl.c>
    # Force HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
    
    # SSL Protocol Configuration
    SSLEngine on
    SSLProtocol -all +TLSv1.2 +TLSv1.3
    
    # Disable vulnerable protocols
    SSLProtocol -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
    
    # Strong cipher suites (GCM only, no CBC)
    SSLCipherSuite ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256
    
    # Honor cipher order
    SSLHonorCipherOrder on
    
    # Disable compression
    SSLCompression off
</IfModule>

<IfModule mod_headers.c>
    # Security headers
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    Header always set X-Frame-Options DENY
    Header always set X-Content-Type-Options nosniff
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Remove server information
    Header unset Server
    Header unset X-Powered-By
    
    # Cache control for security
    <FilesMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg)$">
        Header set Cache-Control "public, max-age=31536000"
    </FilesMatch>
</IfModule>

# Disable server signature
ServerTokens Prod

# Protect sensitive files
<Files ".env">
    Order allow,deny
    Deny from all
</Files>

<Files "*.key">
    Order allow,deny
    Deny from all
</Files>

# Disable directory browsing
Options -Indexes

# Protect against injection attacks
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Block suspicious requests
    RewriteCond %{QUERY_STRING} (<|%3C).*script.*(>|%3E) [NC,OR]
    RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
    RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2}) [OR]
    RewriteCond %{QUERY_STRING} \.\./\.\. [OR]
    RewriteCond %{QUERY_STRING} (;|<|>|'|"|\)|%0A|%0D|%22|%27|%3C|%3E|%00) [NC]
    RewriteRule .* - [F,L]
</IfModule>